<div class="container mt-4">
  <div *ngIf="problem" class="problem-detail">
    <div class="problem-header">
      <h2>{{ problem.title }}</h2>
      <span class="difficulty-badge" [ngClass]="'level-' + problem.difficultyLevel">
        {{ getDifficultyLabel(problem.difficultyLevel) }}
      </span>
    </div>

    <div class="problem-content">
      <div class="description-section">
        <h3>Description</h3>
        <p>{{ problem.description }}</p>

        <div class="test-cases">
          <h4>Test Cases</h4>
          <div class="test-case">
            <h5>Input:</h5>
            <pre>{{ problem.testCaseInput }}</pre>
          </div>
          <div class="test-case">
            <h5>Expected Output:</h5>
            <pre>{{ problem.testCaseOutput }}</pre>
          </div>
        </div>

        <div *ngIf="problem.constraints" class="constraints">
          <h4>Constraints:</h4>
          <p>{{ problem.constraints }}</p>
        </div>
      </div>

      <div class="solution-section">
        <div class="language-selector">
          <label for="language">Select Language:</label>
          <select id="language" [(ngModel)]="selectedLanguage" (ngModelChange)="onLanguageChange()">
            <option *ngFor="let lang of languages" [value]="lang.value">
              {{ lang.label }}
            </option>
          </select>
        </div>

        <div class="code-editor-container">
          <app-code-editor [(code)]="code" [language]="selectedLanguage"></app-code-editor>
        </div>

        <div class="action-buttons">
          <button class="run-button" (click)="runCode()" [disabled]="isRunning">
            {{ isRunning ? 'Running...' : 'Run Code' }}
          </button>
          <button class="submit-button" (click)="submitSolution()" >
            {{ isSubmitting ? 'Submitting...' : 'Submit Solution' }}
          </button>
        </div>

        <div class="test-cases" *ngIf="result">
          <div class="result-card" [ngClass]="{ success: result.success, error: !result.success }">
            <div class="result-header">
              <span>{{ result.success ? 'Success' : 'Failed' }}</span>
              <p>{{ result.message }}</p>
            </div>

            <div *ngIf="result.testResults && result.testResults.length > 0" class="test-results">
              <div *ngFor="let test of result.testResults" class="test-case-result">
                <div class="test-input">
                  <h5>Input:</h5>
                  <pre>{{ test.input }}</pre>
                </div>
                <div class="test-expected">
                  <h5>Expected Output:</h5>
                  <pre>{{ test.expected }}</pre>
                </div>
                <div class="test-actual">
                  <h5>Actual Output:</h5>
                  <pre>{{ test.actual }}</pre>
                </div>
                <div class="test-status" [ngClass]="{ 'passed': test.passed, 'failed': !test.passed }">
                  {{ test.passed ? '✓ Test Passed' : '✗ Test Failed' }}
                </div>
              </div>
            </div>

            <div class="test-case-metrics">
              <div *ngIf="result.executionTime !== undefined" class="metric">
                <span>Execution Time: {{ result.executionTime }} ms</span>
              </div>
              <div *ngIf="result.memoryUsage !== undefined" class="metric">
                <span>Memory Usage: {{ result.memoryUsage }} MB</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="loading-overlay" *ngIf="isLoading">
    <div class="spinner"></div>
    <p>Loading problem details...</p>
  </div>
</div>